/*var obj = {
    "classes": [
        [1, "5а"],
        [2, "5б"],
        [3, "5в"],
        [4, "5д"],
        [5, "5р"],
        [6, "6а"],
        [7, "6б"],
        [8, "6в"],
        [9, "6г"],
        [10, "6д"],
        [11, "6р"],
        [12, "7а"],
        [13, "7б"],
        [14, "7в"],
        [15, "7г"],
        [16, "8а"],
        [17, "8б"],
        [18, "8в"],
        [19, "8г"],
        [20, "9а"],
        [21, "9б"],
        [22, "9в"],
        [23, "9г"],
        [24, "9д"],
        [25, "10а"],
        [26, "10б"],
        [27, "10в"],
        [28, "10г"],
        [29, "11а"],
        [30, "11б"],
        [31, "11в"],
        [32, "11г"]
    ],
    "days": [
        [1, "ПОНЕДІЛОК"],
        [2, "ВІВТОРОК"],
        [3, "СЕРЕДА"],
        [4, "ЧЕТВЕР"],
        [5, "П’ЯТНИЦЯ"]
    ],
    "lessons": [
        [1, 1],
        [2, 2],
        [3, 3],
        [4, 4],
        [5, 5],
        [6, 6],
        [7, 7],
        [8, 8],
        [9, 9],
        [10, 10]
    ],
    "all": [
        [1, "06.04.2020", "ПОНЕДІЛОК", "5а", 1, "10:00-10:20(:30)", "осн\".здоров.", "Вибивана Л.М.", "", "Тема: Сам надворі (5 клас. Основи здоров'я. Нова програма) | Шкільне життя   Параграф 27-читати та писати, короткий тест ст 141-142.", "https://www.schoollife.org.ua/tema-sam-nadvori-5-klas-osnovy-zdorovya-nova-prohrama/"],
        [2, "06.04.2020", "ПОНЕДІЛОК", "5а", 2, "10:40-11:00(:10)", "", "", "", "", ""],
        [3, "06.04.2020", "ПОНЕДІЛОК", "5а", 3, "11:20-11:40(:50)", "", "", "", "", ""],
        [4, "06.04.2020", "понеділок", "5а", 4, "12:00-12:20(:30)", "Укр.літ", "Толочко  І.Г.", "https://zoom.us/j/739390544?pwd=MDhZTVk5eGthdUJWL2RMWWdQUFUwQT09", "Ідентифікатор: 739 390 544    Пароль: 163613", "https://docs.google.com/document/d/175F5hMaDfG2SzMvT9FE0B96JA_1JTFNq5KiZZHovmvQ/edit"],
        [5, "06.04.2020", "ПОНЕДІЛОК", "5а", 5, "12:40-13:00(:10)", "Англ.мова І", "Ганич В.Г.", "https://us04web.zoom.us/j/5680287521?pwd=V1JQeldTdTFRRFlKc0E4Q3FSMEo2dz09", "Ідентифікатор конференції: 568 028 7521         Пароль: 597669", "https://docs.google.com/document/d/1DXIVTqV0Ni_vDVgQsdJ9ME1eWS-YrszCruSzLrGSel0/edit?usp=sharing"],
        [6, "06.04.2020", "ПОНЕДІЛОК", "5а", 5, "12:40-13:00(:10)", "Англ.моваІІ", "Сичевська О.Ю.", "", "", "https://docs.google.com/document/d/1qBK9luE31fd2oztLnbAbsWcV308kVljFG91gIzikCHo/edit?usp=sharing"],
        [7, "06.04.2020", "ПОНЕДІЛОК", "5а", 6, "13:20-13:40(:50)", "Укр.мова І", "Толочко  І.Г.", "", "", "https://docs.google.com/document/d/1Nbrd0BOP74Um40WOFQgUVU6rUH_JFEaxvvmt6vdZkjg/edit"],
        [8, "06.04.2020", "ПОНЕДІЛОК", "5а", 6, "13:20-13:40(:50)", "Укр.мова ІІ", "Гаврилюк  Н.М.", "https://us04web.zoom.us/j/5680287521?pwd=V1JQeldTdTFRRFlKc0E4Q3FSMEo2dz09", "Идентификатор конференции 568 0287521 Пароль: 597669", "https://docs.google.com/document/d/1kANkgkj5DEBA7YEFDsdmZG8941zBjh08aI1fCFLMmQE/edit"],
        [9, "06.04.2020", "ПОНЕДІЛОК", "5а", 7, "14:00-14:20(:30)", "", "", "", "", ""],
        [10, "06.04.2020", "ПОНЕДІЛОК", "5а", 8, "15:00-15:20", "", "", "", "", ""],
        [11, "06.04.2020", "ПОНЕДІЛОК", "5а", 9, "16:00-16:20", "", "", "", "", ""],
        [12, "06.04.2020", "ВІВТОРОК", "5а", 1, "10:00-10:20(:30)", "Пол.мова", "Шульженко Є.О.", "", "", "https://docs.google.com/document/d/1c_1BvY1v-0DEmz1OcxPOKJukZOUP_jYS8RX9_VFk1wM/edit?usp=sharing"],
        [13, "06.04.2020", "ВІВТОРОК", "5а", 1, "10:00-10:20(:30)", "Нім.мова", "", "", "", ""],
        [14, "06.04.2020", "ВІВТОРОК", "5а", 1, "10:00-10:20(:30)", "Фр.мова", "", "", "", ""],
        [15, "06.04.2020", "ВІВТОРОК", "5а", 2, "10:40-11:00(:10)", "укр.мова І", "", "", "", ""],
        [16, "06.04.2020", "ВІВТОРОК", "5а", 2, "10:40-11:00(:10)", "укр.мова ІІ", "", "", "", ""],
        [17, "06.04.2020", "ВІВТОРОК", "5а", 3, "11:20-11:40(:50)", "", "", "", "", ""]
    ]
};*/
/*
var obj = {};
(function() {
    var app = "https://script.google.com/macros/s/AKfycbzEUg6m39aebib5Pl6m6HG6iRqt5kXJRbG1BIZtVSy5_EAix9k/exec",
        output = {},
        xhr = new XMLHttpRequest();
    xhr.open('GET', app);
    xhr.onreadystatechange = function() {
        if (xhr.readyState !== 4) return;
        if (xhr.status == 200) {
            try {
                var output = JSON.parse(xhr.response);
            } catch (e) {}
        }
        app.all = output.all;
        console.log(app.all);
        console.log(output.all);
        app.classes = output.classes;
        app.days = output.days;
        app.lessons = output.lessons;
        app.preloaderStart = false;
        obj = output;
        console.log('log');

    }
    xhr.send()
})()*/

/*
todo: сделать авторизацию
ссылка  для проверки авторизации https://script.google.com/macros/s/AKfycbxrXNJrQRsUZPDFAseYpI09Br5Q05Vl6CGktPBZqQxgLmPAFKwM/exec?id=1&login=vibivana&pass=pass222
id - В случае если один из заготовленых клиентов (упрощает поиск в базе)
login - если просто вводить логин и пароль, не выбирая из предложеных
pass - пароль к акку
*/




Vue.component('preloader', {
    template: `
    <div class="preloader" >
        <div class="preloader__overlay">
            <div class="preloader__container">
                <div id="preloader">
                    <div id="loader"></div>
                </div>
            </div>
        </div>
    </div>
    `
})
Vue.component('VueHeader', {
    data: function() {
        return {
            openUserStatus: false,
            adminNameSearch: ''
        }
    },
    template: `
    <header class="header">
            <div class="header__container">
                <div class="header__content">
                    <div @click="selectUserStatus()" class="header__account">
                        <div class="header__account-icon"><img src="img/user.png" alt=""></div>
                        <div class="header__account-name">{{this.$root.adminName}}</div>
                        <div class="header__account-open-button" v-bind:class="{'header__account-open-button--active':openUserStatus}"></div>
                    </div>
                    <div class="header__account-select account" v-bind:class="{'header__account-select--active':openUserStatus}">
                        <div class="account__container">
                            <div class="account__wrapper">
                                <div class="account__content">
                                    <div class="account__search"><input type="text" class="account__search-input" v-model:value="adminNameSearch" placeholder="Введите имя для поиска"></div>
                                    <div class="account__items">
                                        <ul class="account__list">
                                            <li v-for="teacher in this.$root.inputData.teachers" v-if="teacher[1].toLowerCase().indexOf(adminNameSearch.toLowerCase()) >=0" @click="selectUser(teacher[1])" class="account__item"><span>{{teacher[1]}}</span></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>`,
    methods: {
        selectUserStatus: function() {
            this.openUserStatus = this.openUserStatus ? false : true;
        },
        selectUser: function(name) {
            this.$root.adminName = name;
            this.openUserStatus = false;
        }
    }
});
Vue.component('asideBar', {
    template: `
    <aside class="aside">
        <div class="aside__logo"></div>
        <nav class="nav">
        </nav>
    </aside>
    `
})
Vue.component('aditionalFilter', {
    template: `
    <div class="aditional-filter">
        <div class="aditional-filter__conteiner">
            <div class="aditional-filter__title">
                <h3>Отображать уроки без учителя?</h3>
            </div>
            <div class="aditional-filter__buttons" @click="showEmpty()" v-bind:class="{'aditional-filter__buttons--yes':this.$root.settings.showEmptyLessons , 'aditional-filter__buttons--no':!this.$root.settings.showEmptyLessons}">
                <div class="aditional-filter__button" v-bind:class="{'aditional-filter__button--active': this.$root.settings.showEmptyLessons}">Да</div>
                <div class="aditional-filter__button" v-bind:class="{'aditional-filter__button--active': !this.$root.settings.showEmptyLessons}">Нет</div>
            </div>
        </div>
    </div>
    `,
    methods: {
        showEmpty: function() {
            this.$root.settings.showEmptyLessons = this.$root.settings.showEmptyLessons ? false : true;
        }
    }
})
Vue.component('filtersBlock', {
    data: function() {
        return {
            filterSelect: {
                class: true,
                days: false,
                lessons: false,
                subject: false,
            }
        }
    },
    template: `
    <div class="content__filter-contetn filter">
        <div class="filter__content">
            <div class="filter__title">
                <ul class="filter__title-list">
                    <li class="filter__title-item" @click="selectFilter('class')" v-bind:class="{'filter__title-item--active':filterSelect.class}">
                        <h2>Классы</h2>
                    </li>
                    <li class="filter__title-item" @click="selectFilter('days')" v-bind:class="{'filter__title-item--active':filterSelect.days}">
                        <h2>Дни</h2>
                    </li>
                    <li class="filter__title-item" @click="selectFilter('lessons')" v-bind:class="{'filter__title-item--active':filterSelect.lessons}">
                        <h2>Уроки</h2>
                    </li>
                    <li class="filter__title-item" @click="selectFilter('subject')" v-bind:class="{'filter__title-item--active':filterSelect.subject}">
                        <h2>Предметы</h2>
                    </li>
                </ul>
            </div>
            <div class="filter__items">
                <div class="filter__container">
                    <div class="filter__wrapper">
                        <div v-for="klass in this.$root.inputData.classes" v-if="filterSelect.class" v-bind:class="{'filter__item--active': filterActiveCheck('classFilterArr',klass[1]) }" @click="addFilter('classFilterArr',klass[1])" class="filter__item">{{klass[1]}}</div>
                        <div v-for="day in this.$root.inputData.days" v-if="filterSelect.days" v-bind:class="{'filter__item--active': filterActiveCheck('dayFilterArr',day[1])}" @click="addFilter('dayFilterArr',day[1])" class="filter__item">{{day[1]}}</div>
                        <div v-for="lesson in this.$root.inputData.lessons" v-if="filterSelect.lessons" v-bind:class="{'filter__item--active': filterActiveCheck('lessonsFilterArr',lesson[1])}" @click="addFilter('lessonsFilterArr',lesson[1])" class="filter__item">{{lesson[1]}}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    `,
    methods: {
        addFilter: function(varName, param) {
            console.log(param);
            if (this.$root.filtersArrs[varName].indexOf(param) >= 0) {
                this.$root.filtersArrs[varName].splice(this.$root.filtersArrs[varName].indexOf(param), 1)
            } else {
                this.$root.filtersArrs[varName].push(param);
            }
        },
        selectFilter: function(filterEl) {
            this.filterSelect.class = false;
            this.filterSelect.days = false;
            this.filterSelect.lessons = false;
            this.filterSelect.subject = false;
            this.filterSelect[filterEl] = true;
        },
        filterActiveCheck: function(checkedArr, checkParam) {
            if (this.$root.filtersArrs[checkedArr].indexOf(checkParam) >= 0) return true
            else return false
        }
    }
})
Vue.component('dataTable', {
    data: function() {
        return {
            editText: ''
        }
    },
    template: `
    <div class="table">
        <div class="table__edit-text">{{editText}}</div>
        <table class="table__table">
            <thead>
                <tr class="table__row table__row--head">
                    <th class="table__cell table__cell--head" id>id</th>
                    <th class="table__cell table__cell--head">Дата</th>
                    <th class="table__cell table__cell--head">День</th>
                    <th class="table__cell table__cell--head">Клас</th>
                    <th class="table__cell table__cell--head">Урок</th>
                    <th class="table__cell table__cell--head">Время проведения</th>
                    <th class="table__cell table__cell--head">Предмет</th>
                    <th class="table__cell table__cell--head">Учитель</th>
                    <th class="table__cell table__cell--head">посилання на ефір</th>
                    <th class="table__cell table__cell--head">роз'яснення вчителя</th>
                    <th class="table__cell table__cell--head">посилання на д\\з</th>
                </tr>
            </thead>
            <tbody>
                <tr v-for="item in this.$root.inputData.all" v-if="rowRender(item)" v-on:change="this.$root.save(item)" class="table__row">
                    <td class="table__cell table__cell--empty">{{item[0]}}</td>
                    <td class="table__cell table__cell--empty">{{item[1]}}</td>
                    <td class="table__cell table__cell--empty">{{item[2]}}</td>
                    <td class="table__cell table__cell--empty">{{item[3]}}</td>
                    <td class="table__cell table__cell--empty">{{item[4]}}</td>
                    <td class="table__cell table__cell--empty">{{item[5]}}</td>
                    <td class="table__cell table__cell--empty">{{item[6]}}</td>
                    <td class="table__cell"><input onFocus="this.select()" class="table__cell-input" v-on:click="editTextChange(item[7])" type="text" v-model:value="item[7]"></td>
                    <td class="table__cell"><input onFocus="this.select()" class="table__cell-input" v-on:click="editTextChange(item[8])" type="text" v-model:value="item[8]"></td>
                    <td class="table__cell"><input onFocus="this.select()" class="table__cell-input" v-on:click="editTextChange(item[9])" type="text" v-model:value="item[9]"></td>
                    <td class="table__cell"><input onFocus="this.select()" class="table__cell-input" v-on:click="editTextChange(item[10])" type="text" v-model:value="item[10]"></td>
                </tr>
            </tbody>
        </table>
    </div>
    `,
    methods: {
        editTextChange: function(text) {
            this.editText = text;
        },
        rowRender: function(item) {
            return this.$root.checkFilter(item);
        }
    }
})

var app = new Vue({
    el: '#app',
    data: {
        filtersArrs: {
            classFilterArr: [],
            dayFilterArr: [],
            lessonsFilterArr: [],
            subjectFilterArr: [],
        },
        inputData: {
            all: [],
            classes: [],
            days: [],
            lessons: [],
            teachers: [],
        },
        url: 'https://script.google.com/macros/s/AKfycbxCkbTMCe_FzyVQTxt2NTYxROMy5zCh52MILKgW6ra5wny2FLY/exec',
        adminName: 'Вибивана Л.М.',
        preloaderStart: true,
        settings: {
            showEmptyLessons: false,
        },


    },
    methods: {
        save: function(arr) {
            console.log(arr)
            var urlSend = `${this.url}?id=${arr[0]}&teacher=${arr[7]}&href=${arr[8]}&teacherInfo=${arr[9]}&hw=${arr[10]}`;
            console.log(urlSend);
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.open("GET", urlSend, true); // true for asynchronous 
            xmlHttp.send(null);
        },
        settingsCheck(arr) {
            var out = false; // Нужно для окончательного вывода
            if (this.adminName == arr[7] || (this.settings.showEmptyLessons ? arr[7].trim() == '' : false)) {
                out = true;
            } else {
                return false;
            }
            return out;
        },
        checkFilter: function(arr) {
            var out = true;
            out = this.settingsCheck(arr);
            if (!out) return false;
            // проверка на пустоту масивов фильтра
            if (this.filtersArrs.classFilterArr.length == 0 &&
                this.filtersArrs.dayFilterArr.length == 0 &&
                this.filtersArrs.lessonsFilterArr.length == 0 &&
                this.filtersArrs.subjectFilterArr.length == 0) {
                return true;
            }
            // Проверка на фильтр класса
            if (this.filtersArrs.classFilterArr.indexOf(arr[3]) >= 0 || this.filtersArrs.classFilterArr.length == 0) {
                out = true;
            } else {
                return false;
            }
            //Проверка на фильтр дня
            if (this.filtersArrs.dayFilterArr.indexOf(arr[2]) >= 0 || this.filtersArrs.dayFilterArr.length == 0) {
                out = true;
            } else {
                return false;
            }
            //проверка на фильтр урока
            if (this.filtersArrs.lessonsFilterArr.indexOf(arr[4]) >= 0 || this.filtersArrs.lessonsFilterArr.length == 0) {
                out = true;
            } else {
                return false;
            }
            return out;
        },
        getData: function() {
            var app = "https://script.google.com/macros/s/AKfycbzEUg6m39aebib5Pl6m6HG6iRqt5kXJRbG1BIZtVSy5_EAix9k/exec",
                output = {},
                xhr = new XMLHttpRequest();
            xhr.open('GET', app);
            xhr.onreadystatechange = function() {
                if (xhr.readyState !== 4) return;
                if (xhr.status == 200) {
                    try {
                        var output = JSON.parse(xhr.response);
                    } catch (e) {}
                }
                console.log(output)
                console.log('log');
                saveData(output);
            }
            xhr.send()
        }
    },
    beforeMount: function() {
        this.getData();

    },
    watch: {}

})

function saveData(data) {
    app.inputData.all = data.all;
    app.inputData.classes = data.classes;
    app.inputData.days = data.days;
    app.inputData.lessons = data.lessons;
    app.inputData.teachers = data.teachers;
    app.preloaderStart = false;
}